<!--terminal aliases: afs; goexp; git pull -->

<!--cgi-bin directory for scripts to be executed (eg: php script to save data to server); WWW/expts for files that don't need to be executed-->

<!DOCTYPE html>

<html>
    <head>
        <title>FUNCTIONAL elmo</title>        
        <script src="./jsPsych/jspsych.js"></script> 
        <script src="./jsPsych/plugins/jspsych-external-html.js"></script>
        <script src="./jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="./jsPsych/plugins/jspsych-html-button-response.js"></script>
        <script src="./jsPsych/plugins/jspsych-survey-text.js"></script>
        <script src="./jsPsych/plugins/jspsych-image-button-response.js"></script>
        <script src="./jsPsych/plugins/jspsych-survey-html-form.js"></script>
        <script src="./jsPsych/plugins/jspsych-audio-button-response.js"></script>
        <script src="./jsPsych/plugins/jspsych-fullscreen.js"></script>
        <script src="./jsPsych/plugins/jspsych-instructions.js"></script>
        <script src="./jsPsych/plugins/jspsych-video-button-response.js"></script>
         
<!--        <script src="./SCIP_jsPsych-summer.css"> </script>  -->
        <link href="./jsPSych/css/SCIP_jspsych.css" rel="stylesheet" type="text/css"/> 
        
        <script src="./jsPsych/mmturkey.js"></script>
        <script src="./jsPsych/jquery-1.11.2.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
        <link type="text/css" href ="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css" rel="stylesheet"/>
    </head>
    
   <!-- <style>
        .container {
            position: relative;
            width: 100%;
            max-width: 400px;
        }
        .container img {
            width: 100%;
            height: auto;
        }

        .container .left-btn {
            position: absolute;
            top: 50%;
            left: 25%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            background-color: #f1f1f1;
            color: red;
            font-size: 16px;
            padding: 16px 30px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
        }
         .container .right-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            background-color: #f1f1f1;
            color: black;
            font-size: 16px;
            padding: 16px 30px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
        }
</style>
-->
    <body> <p id="demo"></p> </body>

<script> 

var timeline = [];
    
    /* IN PROGRESS: insert external html link to welcome screen ---- "welcome-screen.html" */
        
/*var welcomeExternal = {
  type:'external-html',
  url: "welcome-screen.html",
//  check_fn: check_input,
  cont_btn: "start"
};
    timeline.push(welcomeExternal);*/

/*    var welcomeScreen = {
        type: 'survey-html-form',
        preamble: "Please enter the following: <img src= './SCIP_images/stanford.png'>",
        button_label: "Begin Game",
        dataAsArray: 'true',
        html: "<p>Subject ID <input id="subjectID" type="text"/><br><br>List Number <br><br>"
    }
    timeline.push(welcomeScreen);*/
    
    /*var check_input = function(elem) {
  if (document.getElementById('subjectID').checked) {
    return true;
  }
  else {
    alert("Please enter valid subject ID");
    return false;
  }
  return false;
};*/
   // timeline.push(welcome);
    
    var subjectID = '';
    var subjectAge = '';
    var listNum = '';
    var d = new Date();
    //var testDate = document.getElementById("demo").innerHTML = d.getDate();*/
    
    /* adding subject#,age,list#,test date to data object  */
    jsPsych.data.addProperties({
        subjectID: subjectID,  /*text input from intro slide */
        subjectAge: subjectAge,/*text input from intro slide */
        listNum: listNum, /*text input from intro slide */
        testDate: d/*text input from intro slide */
    });
        
    var welcome2 = {
        type: 'html-keyboard-response',
        stimulus: '<center><p>Welcome to our game. Press any key to continue.</center>'
    };
    timeline.push(welcome2);
    
    var inputScreen = {
        type: 'survey-text',
        preamble: "Please enter the following information before proceeding:",
        questions: [
            {prompt: "Subject ID:", name:'subjectID'},
            {prompt: "Age Group", name: 'age'},
            {prompt: "List Number:", name: 'listNum'},
            {prompt: "Today's Date", name: 'testDate'}
        ]
    };
    timeline.push(inputScreen);

/* entering fullscreen mode */
    timeline.push({  
        type: 'fullscreen',
        button_label: 'Enter',
        fullscreen_mode: true
    });
    
    var intro = {
        type: 'instructions',
        pages: ["<p><center>This is Elmo!" + "<p> Elmo LOVES gumballs!" + "<p><img src='./SCIP_images/Elmo-waves_screenshot.jpeg' height=500>",
                "<p><center> In this game, Elmo will show you which jars of gumballs he likes better than others." + 
                "<p><center>Your job is to <em>remember</em> what he likes, so that you can help him out later in the game!" + 
                "<p><center><img src='./SCIP_images/Elmo-waves_screenshot.jpeg' height=500>", 
        "<center><br><br><br>Press <b>'Next'</b> when you're ready to see which jars of gumballs Elmo likes!<br><br><br>"],
        show_clickable_nav: true
    }
    timeline.push(intro);
        
    var familiarization = {
        type: 'video-button-response',
        width: 1200, 
        start: 0,
        controls: false,
        sources: ['SCIP_videos/fam-ALL.mp4'],
        choices: ['continue']
    }
    timeline.push(familiarization);
        
        
    /*
    var familiarization = {
        type: 'video',
        width: 800, 
        start: 0,
        controls: true,
        timeline: [
            sources:['../SCIP_videos/fam-I.mp4',
                      '../SCIP_videos/fam-II.mp4',
                      '../SCIP_videos/fam-III.mp4',
                      '../SCIP_videos/fam-IV.mp4'
                      ]
        ]
    }
    */
        
    var testInstructions = {
        type: 'instructions',
        pages: ["<center><p> Now that Elmo has shown you what he likes, he needs your help!<br>",
                "<center><p> On the next screen, you will see two jars of gumballs.<br>" + "<center><p>Use the trackpad (laptop) or your finger (tablet) to click on the jar that Elmo would like better!<br><br><br> <b>Are you ready?</b>"],
        show_clickable_nav: 'true'
    }
    timeline.push(testInstructions);
    
    // timeline.push(fixation);

/* Write a function that plays a sound when image is clicked  */
    
/* TODO: add list# and maybe trial# to data  */
    var testBlock = {
        type: 'html-button-response',
        timeline:[
            {          /* recap-I */
            stimulus: '<center><img src= "./SCIP_test-trials/t1_Y1-B2O.jpeg" width=800>',
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-1',
                trial_type: 'recap-I',
                correct_jar: 'right',
                leftJarInfo: ['yellow','1'],
                rightJarInfo: ['blue','2']}
             },
                    /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                    /*generalization-I*/
            {stimulus: "<center><img src = './SCIP_test-trials/t2_G3-Y1.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-2',
                trial_type: 'gen-I',
                correct_jar: 'left',
                leftJarInfo: ['green','3'],
                rightJarInfo: ['yellow','1']}
            },
                        /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* critical trial (B-R) */
            {stimulus: "<center><img src = './SCIP_test-trials/t3_B2O-R4O.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-3',
                trial_type: 'critical',
                correctJar: 'right',
                leftJarInfo: ['blue','2'],
                rightJarInfo: ['red','4']
                }
            },
                        /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* recap trial IV */
            {stimulus: "<center><img src = './SCIP_test-trials/t4_P5-R4O.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-4',
                trial_type: 'recap-IV',
                correct_jar: 'left',
                leftJarInfo: ['purple','5'],
                rightJarInfo: ['red','4']
             }
            },
                         /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* generalization trial II */
            {stimulus: "<center><img src = './SCIP_test-trials/t5_P5-G3.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-5',
                trial_type: 'gen-II',
                correct_jar: 'left',
                leftJarInfo: ['purple','5'],
                rightJarInfo: ['green','3']}
            },
                         /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* recap trial III */
            {stimulus: "<center><img src = './SCIP_test-trials/t6_G3-R4O.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-6',
                trial_type: 'recap-III',
                correct_jar: 'right',
                leftJarInfo: ['green','3'],
                rightJarInfo: ['red','4']}
            },
                         /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* recap trial II */
            {stimulus: "<center><img src = './SCIP_test-trials/t7_B2O-G3.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'
            ],
             data:{
                trialId: 'trial-7',
                trial_type: 'recap-II',
                correct_jar: 'right',
                leftJarInfo: ['blue','2'],
                rightJarInfo: ['green','3']}
            },
                         /* fixation trial */
            {stimulus:'<p style="font-size: 48px; font-color: blue;">+</p>',
             choices: '',
             prompt: '',
             trial_duration: 500
            },
                        /* critical trial (R-B) */
             {stimulus: "<center><img src='./SCIP_test-trials/t8_R4O-B2O.jpeg'  width=800>",
             button_html: [
            '<button class="btn-left-jar-trspnt"></button>',
            '<button class="btn-right-jar-trspnt"></button>'],
             data:{
                trialId: 'trial-8',
                trial_type: 'critical',
                correct_jar: 'left',
                leftJarInfo: ['red','4'],
                rightJarInfo: ['blue','2']}
            }
        ], 
        prompt: "<center>Which jar do you think Elmo will pick?",
        margin_vertical: '-1200px',
        choices: ['left', 'right'],
        is_html: 'true'
    }
    timeline.push(testBlock);
        
  /* Exiting fullscreen mode   */      
    timeline.push({
        type: 'fullscreen',
        fullscreen_mode: false
    });
    
    var final = {
        type: 'html-keyboard-response',
        stimulus: "<center><br><br><br>Thanks for playing the game with us!",
    }
    timeline.push(final);
        
    // select all trials
var all_data = jsPsych.data.get().csv();
    //filter just exp trials (plus fixate-trials, other misc.)
var SCIP1data = jsPsych.data.get().filter({trial_type: 'html-button-response'});
    
    // get csv representation of data and log to console
console.log(SCIP1data.csv());
    
  function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', '../../../../cgi-bin/write-data-SCIP.php'); // 'write-data-SCIP.php' is the path to the php file in /cgi-bin.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}

// call the saveData function after the experiment is over 
    jsPsych.init({
        display_element: $('#jspsych-target'),
        timeline: timeline,
        default_iti: 500,
        preload_images: ['./SCIP_images/Elmo-waves_screenshot.jpeg'],
        on_finish: function() {saveData("../cgi-bin/SCIP_PP/exp1-data", SCIP1data);}
    });   
    
    
</script>

</html>